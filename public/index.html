<!doctype html>
<html lang="en">
  <head>
    <!-- Required meta tags -->
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

    <!-- Bluma -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bulma@0.9.3/css/bulma.min.css">
    
    <title>Dashboard - CamSalvo</title>
  </head>
  <body>
    <div id="app">
        <header>
            <nav class="navbar is-dark" role="navigation" aria-label="main navigation">
                <div class="navbar-brand">
                  <a class="navbar-item" href="#">
                    CamSalvo
                  </a>
              
                  <a role="button" class="navbar-burger" aria-label="menu" aria-expanded="false" data-target="navbarBasicExample">
                    <span aria-hidden="true"></span>
                    <span aria-hidden="true"></span>
                    <span aria-hidden="true"></span>
                  </a>
                </div>
              
                <div id="navbarBasicExample" class="navbar-menu">
                  <div class="navbar-start">
                    
                  </div>
                  <div class="navbar-end">
                    <div class="navbar-item">
                      <div class="buttons">
                        <a class="button is-primary">
                          <strong>Capture all!</strong>
                        </a>
                      </div>
                    </div>
                  </div>
                </div>
              </nav>
        </header>
        <main>
            <div class="columns is-multiline" style="padding: 10px;">
                <div class="column is-one-quarter-desktop is-half-tablet">
                  <div class="card">
                    <header class="card-header">
                        <p class="card-header-title">
                          Card header
                        </p>
                        <button class="card-header-icon" aria-label="more options">
                          <span class="icon">
                            <i class="fas fa-angle-down" aria-hidden="true"></i>
                          </span>
                        </button>
                      </header>
                      <div class="card-image">
                          <figure class="image is-3by2">
                            <img src="https://unsplash.it/300/200/?random&pic=1" alt="">
                          </figure>
                      </div>
                      <footer class="card-footer">
                          <a class="card-footer-item">
                            Capture
                          </a>
                      </footer>
                  </div>
                </div>    
            </div>
         </main>
        <footer>

        </footer>
    </div>

    <!-- Optional JavaScript -->
    <!-- jQuery first, then Popper.js, then Bootstrap JS -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/socket.io/4.3.2/socket.io.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/vue/3.2.20/vue.global.min.js"></script>
    <script>
 
    </script>
    <script>
        const DashboardApp = {
            data(){
                return {
                    camearas: {},
                    socket: undefined,
                    config: undefined
                }
            },
            mounted(){
                this.connect();
            },
            methods: {
                async connect(){
                    response = await fetch('config.json'); 
                    if(!response.ok) return this.dialogue("Error: could not load config.json");
                    this.config = await response.json();
                    this.init_socket();
                },
                init_socket(){
                    self = this;
                    socket_url = 'ws://'+this.config.socket_server.address+':'+this.config.socket_server.port+'/dashboard';
                    console.log(socket_url);
                    this.socket = io(socket_url)
                    this.socket.on('connect', ()=>{
                        console.log("CONNECTED")
                    });
                    this.socket.on('connect_error', error=>self.dialogue('could not conenct to socket server. please verify that node.js is up and running with proper config.js'))
                    this.socket.on('reconnect_failed', error=>self.dialogue('internete disconnect! you might move your phone to far away from internet access point'))
                    this.socket.on('add_camera', this.add_camera)
                    this.socket.on('remove_camera', this.remove_camera)                    
                },
                dialogue(message){
                    alert(message);
                },
                add_camera(data){
                    console.log('ADD camera')
                    console.log(data)
                }, 
                remove_camera(data){
                    console.log('remove camera')
                    console.log(data)
                }
            }
        }
        Vue.createApp(DashboardApp).mount('#app')        
    </script>

  </body>
</html>